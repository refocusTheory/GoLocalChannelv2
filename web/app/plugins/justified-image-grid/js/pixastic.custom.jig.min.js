/*!
 * @preserve
 * Pixastic Lib - Core Functions - v0.1.3
 * Copyright (c) 2008 Jacob Seidelin, jseidelin@nihilogic.dk, http://blog.nihilogic.dk/
 * License: [http://www.pixastic.com/lib/license.txt]
 */
var Pixastic=function(){function s(t,a,e){var n=new Array;null==a&&(a=document),null==e&&(e="*");var r=a.getElementsByTagName(e),s=r.length,o=new RegExp("(^|\\s)"+t+"(\\s|$)");for(i=0,j=0;i<s;i++)o.test(r[i].className)&&(n[j]=r[i],j++);return n}function m(){Pixastic.debug}"undefined"!=typeof pixastic_parseonload&&pixastic_parseonload&&function(){function t(){a||(a=!0,function(){for(var t=s("pixastic",null,"img"),a=s("pixastic",null,"canvas"),h=t.concat(a),l=0;l<h.length;l++)!function(){for(var e=h[l],i=[],t=e.className.split(" "),a=0;a<t.length;a++){var n,r=t[a];"pixastic-"!=r.substring(0,9)||""!=(n=r.substring(9))&&i.push(n)}if(i.length)if("img"==e.tagName.toLowerCase()){var s=new Image;if(s.src=e.src,s.complete)for(var o=0;o<i.length;o++){var c=Pixastic.applyAction(e,e,i[o],null);c&&(e=c)}else s.onload=function(){for(var t=0;t<i.length;t++){var a=Pixastic.applyAction(e,e,i[t],null);a&&(e=a)}}}else setTimeout(function(){for(var t=0;t<i.length;t++){var a=Pixastic.applyAction(e,e,i[t],null);a&&(e=a)}},1)}()}())}var a=!1;document.write('<script defer src="//:" id="__onload_ie_pixastic__"><\/script>');var e,i,n,r=document.getElementById("__onload_ie_pixastic__");r.onreadystatechange=function(){"complete"==r.readyState&&(r.parentNode.removeChild(r),t())},document.addEventListener&&document.addEventListener("DOMContentLoaded",t,!1),i="load",n=t,(e=window).addEventListener?e.addEventListener(i,n,!1):e.attachEvent&&e.attachEvent("on"+i,n)}();var t,a,e,n,r,o=function(){var t=document.createElement("canvas"),a=!1;try{a=!("function"!=typeof t.getContext||!t.getContext("2d"))}catch(t){}return function(){return a}}(),c=function(){var t,a=document.createElement("canvas"),e=!1;try{"function"==typeof a.getContext&&(t=a.getContext("2d"))&&(e="function"==typeof t.getImageData)}catch(t){}return function(){return e}}(),h=(n=!1,r=document.createElement("canvas"),o()&&c()&&(r.width=r.height=1,(t=r.getContext("2d")).fillStyle="rgb(255,0,0)",t.fillRect(0,0,1,1),(a=document.createElement("canvas")).width=a.height=1,(e=a.getContext("2d")).fillStyle="rgb(0,0,255)",e.fillRect(0,0,1,1),t.globalAlpha=.5,t.drawImage(a,0,0),n=255!=t.getImageData(0,0,1,1).data[2]),function(){return n});return{parseOnLoad:!1,debug:!1,applyAction:function(t,a,e,i){i=i||{};var n,r,s="canvas"==t.tagName.toLowerCase();if(s&&Pixastic.Client.isIE())return Pixastic.debug&&m(),!1;var o=!1;Pixastic.Client.hasCanvas()&&(o=!!i.resultCanvas,r=(n=i.resultCanvas||document.createElement("canvas")).getContext("2d"));var c=t.offsetWidth,h=t.offsetHeight;if(s&&(c=t.width,h=t.height),0==c||0==h){if(null!=t.parentNode)return void(Pixastic.debug&&m());var l=t.style.position,d=t.style.left;t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),c=t.offsetWidth,h=t.offsetHeight,document.body.removeChild(t),t.style.position=l,t.style.left=d}if("blurfast"!==e&&void 0!==i.retinaReady&&"yes"===i.retinaReady&&void 0!==i.devicePixelRatio&&(c=Math.floor(c*i.devicePixelRatio),h=Math.floor(h*i.devicePixelRatio),void 0!==t.naturalWidth&&void 0!==t.naturalHeight&&0<t.naturalWidth&&0<t.naturalHeight&&(c>t.naturalWidth||h>t.naturalHeight)&&(c=t.naturalWidth,h=t.naturalHeight)),-1<e.indexOf("(")){var g=e;e=g.substr(0,g.indexOf("("));var p=g.match(/\((.*?)\)/);if(p[1]){p=p[1].split(";");for(var u,v=0;v<p.length;v++)thisArg=p[v].split("="),2==thisArg.length&&("rect"==thisArg[0]?(u=thisArg[1].split(","),i[thisArg[0]]={left:parseInt(u[0],10)||0,top:parseInt(u[1],10)||0,width:parseInt(u[2],10)||0,height:parseInt(u[3],10)||0}):i[thisArg[0]]=thisArg[1])}}i.rect?(i.rect.left=Math.round(i.rect.left),i.rect.top=Math.round(i.rect.top),i.rect.width=Math.round(i.rect.width),i.rect.height=Math.round(i.rect.height)):i.rect={left:0,top:0,width:c,height:h};var f=!1;if(Pixastic.Actions[e]&&"function"==typeof Pixastic.Actions[e].process&&(f=!0),!f)return Pixastic.debug&&m(),!1;if(!Pixastic.Actions[e].checkSupport())return Pixastic.debug&&m(),!1;Pixastic.Client.hasCanvas()?(n!==t&&(n.width=c,n.height=h),o||(n.style.width=c+"px",n.style.height=h+"px"),r.drawImage(a,0,0,c,h),t.__pixastic_org_image?(n.__pixastic_org_image=t.__pixastic_org_image,n.__pixastic_org_width=t.__pixastic_org_width,n.__pixastic_org_height=t.__pixastic_org_height):(n.__pixastic_org_image=t,n.__pixastic_org_width=c,n.__pixastic_org_height=h)):Pixastic.Client.isIE()&&void 0===t.__pixastic_org_style&&(t.__pixastic_org_style=t.style.cssText);var x={image:t,canvas:n,width:c,height:h,useData:!0,options:i};return!!Pixastic.Actions[e].process(x)&&(Pixastic.Client.hasCanvas()?(x.useData&&Pixastic.Client.hasCanvasImageData()&&(n.getContext("2d").putImageData(x.canvasData,i.rect.left,i.rect.top),n.getContext("2d").fillRect(0,0,0,0)),i.leaveDOM||(n.title=t.title,n.imgsrc=t.imgsrc,s||(n.alt=t.alt),s||(n.imgsrc=t.src),n.className=t.className,n.style.cssText=t.style.cssText,n.name=t.name,n.tabIndex=t.tabIndex,n.id=t.id,t.parentNode&&t.parentNode.replaceChild&&t.parentNode.replaceChild(n,t)),i.resultCanvas=n):t)},prepareData:function(t,a){var e=t.canvas.getContext("2d"),i=t.options.rect,n=e.getImageData(i.left,i.top,i.width,i.height),r=n.data;return a||(t.canvasData=n),r},process:function(a,e,i,n){if("img"==a.tagName.toLowerCase()){var r=new Image;if(r.src=a.src,r.complete){var t=Pixastic.applyAction(a,r,e,i);return n&&n(t,a),t}r.onload=function(){var t=Pixastic.applyAction(a,r,e,i);n&&n(t,a)}}if("canvas"==a.tagName.toLowerCase())return t=Pixastic.applyAction(a,a,e,i),n&&n(t,a),t},revert:function(t){if(Pixastic.Client.hasCanvas()){if("canvas"==t.tagName.toLowerCase()&&t.__pixastic_org_image)return t.width=t.__pixastic_org_width,t.height=t.__pixastic_org_height,t.getContext("2d").drawImage(t.__pixastic_org_image,0,0),t.parentNode&&t.parentNode.replaceChild&&t.parentNode.replaceChild(t.__pixastic_org_image,t),t}else Pixastic.Client.isIE()&&void 0!==t.__pixastic_org_style&&(t.style.cssText=t.__pixastic_org_style)},Client:{hasCanvas:o,hasCanvasImageData:c,hasGlobalAlpha:h,isIE:function(){return!!document.all&&!!window.attachEvent&&!window.opera}},Actions:{}}}();"undefined"!=typeof jQuery&&jQuery&&jQuery.fn&&(jQuery.fn.pixastic=function(a,e){var i=[];return this.each(function(){var t;"img"==this.tagName.toLowerCase()&&!this.complete||(t=Pixastic.process(this,a,e))&&i.push(t)}),0<i.length?jQuery(i):this}),Pixastic.Actions.blurfast={process:function(t){var a=parseFloat(t.options.amount)||0,a=(t.options.clear&&t.options.clear,Math.max(0,Math.min(5,a)));if(Pixastic.Client.hasCanvas()){var e=t.options.rect,i=t.canvas.getContext("2d");i.save(),i.beginPath(),i.rect(e.left,e.top,e.width,e.height),i.clip();var n=Math.round(t.width/2),r=Math.round(t.height/2),s=document.createElement("canvas");s.width=n,s.height=r;for(var o=Math.round(20*a),c=s.getContext("2d"),h=0;h<o;h++){var l=Math.max(1,Math.round(n-h)),d=Math.max(1,Math.round(r-h));c.clearRect(0,0,n,r),c.drawImage(t.canvas,0,0,t.width,t.height,0,0,l,d),i.drawImage(s,0,0,l,d,0,0,t.width,t.height)}return i.restore(),!(t.useData=!1)}if(Pixastic.Client.isIE()){var g=10*a;return t.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius="+g+")",t.options.fixMargin,t.image.style.marginLeft=(parseInt(t.image.style.marginLeft,10)||0)-Math.round(g)+"px",t.image.style.marginTop=(parseInt(t.image.style.marginTop,10)||0)-Math.round(g)+"px",!0}},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}},Pixastic.Actions.desaturate={process:function(t){var a=!(!t.options.average||"false"==t.options.average);if(Pixastic.Client.hasCanvasImageData()){var e,i,n=Pixastic.prepareData(t),r=t.options.rect,s=r.width*r.height,o=4*s;if(a)for(;s--;)n[o-=4]=n[e=o+1]=n[i=o+2]=(n[o]+n[e]+n[i])/3;else for(;s--;)n[o-=4]=n[e=o+1]=n[i=o+2]=.3*n[o]+.59*n[e]+.11*n[i];return!0}if(Pixastic.Client.isIE())return t.image.style.filter+=" gray",!0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}},Pixastic.Actions.glow={process:function(t){var a=parseFloat(t.options.amount)||0,e=parseFloat(t.options.radius)||0,a=Math.min(1,Math.max(0,a)),e=Math.min(5,Math.max(0,e));if(Pixastic.Client.hasCanvasImageData()){var i=t.options.rect,n=document.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");r.drawImage(t.canvas,0,0);var s=Math.round(t.width/2),o=Math.round(t.height/2),c=document.createElement("canvas");c.width=s,c.height=o;for(var h=Math.round(20*e),l=c.getContext("2d"),d=0;d<h;d++){var g=Math.max(1,Math.round(s-d)),p=Math.max(1,Math.round(o-d));l.clearRect(0,0,s,o),l.drawImage(n,0,0,t.width,t.height,0,0,g,p),r.clearRect(0,0,t.width,t.height),r.drawImage(c,0,0,g,p,0,0,t.width,t.height)}for(var u=Pixastic.prepareData(t),v=Pixastic.prepareData({canvas:n,options:t.options}),f=i.width*i.height,x=4*f,m=x+1,_=x+2;f--;)255<(u[x-=4]+=a*v[x])&&(u[x]=255),255<(u[m-=4]+=a*v[m])&&(u[m]=255),255<(u[_-=4]+=a*v[_])&&(u[_]=255);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.laplace={process:function(t){var a=!(!t.options.invert||"false"==t.options.invert),e=parseFloat(t.options.edgeStrength)||0,i=parseInt(t.options.greyLevel)||0,e=-e;if(Pixastic.Client.hasCanvasImageData()){var n=Pixastic.prepareData(t),r=Pixastic.prepareData(t,!0),s=t.options.rect,o=s.width,c=s.height,h=4*o,l=c;do{var d=(l-1)*h,g=(1==l?0:l-2)*o*4,p=(l==c?l-1:l)*o*4,u=o;do{var v=4*u-4+d,f=g+4*(1==u?0:u-2),x=p+4*(u==o?u-1:u),m=((-r[f-4]-r[f]-r[4+f]-r[v-4]-r[4+v]-r[x-4]-r[x]-r[4+x]+8*r[v])*(1/8)+(-r[f-3]-r[1+f]-r[5+f]-r[v-3]-r[5+v]-r[x-3]-r[1+x]-r[5+x]+8*r[1+v])*(1/8)+(-r[f-2]-r[2+f]-r[6+f]-r[v-2]-r[6+v]-r[x-2]-r[2+x]-r[6+x]+8*r[2+v])*(1/8))/3+i;0!=e&&(127<m?m+=(m+1-128)*e:m<127&&(m-=(m+1)*e)),a&&(m=255-m),m<0&&(m=0),255<m&&(m=255),n[v]=n[1+v]=n[2+v]=m}while(--u)}while(--l);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.sepia={process:function(t){var a=parseInt(t.options.mode,10)||0;if(a<0&&(a=0),1<a&&(a=1),Pixastic.Client.hasCanvasImageData()){var e=Pixastic.prepareData(t),i=t.options.rect,n=i.width,r=4*n,s=i.height;do{var o=(s-1)*r,c=n;do{var h,l,d,g,p,u,v=o+4*(c-1),f=a?(p=39+(h=.299*e[v]+.587*e[1+v]+.114*e[2+v]),u=14+h,h-36):(p=.393*(l=e[v])+.769*(d=e[1+v])+.189*(g=e[2+v]),u=.349*l+.686*d+.168*g,.272*l+.534*d+.131*g);p<0&&(p=0),255<p&&(p=255),u<0&&(u=0),255<u&&(u=255),f<0&&(f=0),255<f&&(f=255),e[v]=p,e[1+v]=u,e[2+v]=f}while(--c)}while(--s);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};